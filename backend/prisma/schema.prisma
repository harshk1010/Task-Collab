generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String           @id @default(uuid())
  name         String
  email        String           @unique
  password     String
  boards       Board[]          @relation("BoardOwner")
  assignments  TaskAssignment[]
  boardMembers BoardMember[]
  createdAt    DateTime         @default(now())
}

model Board {
  id         String        @id @default(uuid())
  title      String
  ownerId    String
  owner      User          @relation("BoardOwner", fields: [ownerId], references: [id])
  lists      List[]
  members    BoardMember[]
  activities Activity[]
  createdAt  DateTime      @default(now())
}

model BoardMember {
  id      String @id @default(uuid())
  userId  String
  boardId String

  user  User  @relation(fields: [userId], references: [id])
  board Board @relation(fields: [boardId], references: [id])

  @@unique([userId, boardId])
}

model List {
  id      String @id @default(uuid())
  title   String
  order   Int
  boardId String

  board Board  @relation(fields: [boardId], references: [id])
  tasks Task[]

  @@index([boardId])
}

model Task {
  id          String  @id @default(uuid())
  title       String
  description String?
  order       Int
  listId      String

  list        List             @relation(fields: [listId], references: [id])
  assignments TaskAssignment[]
  createdAt   DateTime         @default(now())

  @@index([listId])
}

model TaskAssignment {
  id     String @id @default(uuid())
  taskId String
  userId String

  task Task @relation(fields: [taskId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@unique([taskId, userId])
}

model Activity {
  id      String @id @default(uuid())
  type    String
  message String
  boardId String

  board     Board    @relation(fields: [boardId], references: [id])
  createdAt DateTime @default(now())

  @@index([boardId])
}
